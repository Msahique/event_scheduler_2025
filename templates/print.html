<!DOCTYPE html>
<html>
<head>
  <title>PDF Preview Workflow</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    #preview-container {
      display: none;
      margin: 20px auto;
      width: 210mm;
      min-height: 297mm;
      border: 1px solid #ccc;
      background: white;
      padding: 20px;
      font-family: Arial, sans-serif;
    }

    .logo {
      width: 50px;
      height: auto;
    }

    .header {
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 20px;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 12px;
      color: #444;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }

    table, th, td {
      border: 1px solid #ddd;
    }

    th, td {
      padding: 8px;
      text-align: left;
    }

    .button-group {
      margin-bottom: 20px;
      text-align: center;
    }

    @media print {
      .button-group {
        display: none;
      }
    }
  </style>
</head>
<body>

<div class="button-group">
  <button onclick="showPreview()">üîç Preview</button>
</div>

<div id="preview-container">
  <div class="button-group">
    <button onclick="printPreview()">üñ®Ô∏è Print</button>
    <button onclick="generatePDF(config)">‚¨áÔ∏è Download PDF</button>
  </div>

  <div id="preview"></div>
</div>

<script>
  const config = {
    header: {
      text: "üßæ Medical Report",
      fontSize: 18,
      align: "center"
    },
    logo: {
      url: "https://www.google.com/url?sa=i&url=https%3A%2F%2Fwww.freepik.com%2Ffree-photos-vectors%2Fhealthcare-logo&psig=AOvVaw05Ofr7YGi2WRHJeQaamPq5&ust=1751779038732000&source=images&cd=vfe&opi=89978449&ved=0CBQQjRxqFwoTCLjIh9H7pI4DFQAAAAAdAAAAABAE",
      width: 50
    },
    content: {
      items: [
        { field: "Patient Name", value: "John Doe" },
        { field: "Age", value: "35" },
        { field: "Blood Pressure", value: "120/80 mmHg" },
        { field: "Blood Sugar", value: "90 mg/dL" },
        { field: "Diagnosis", value: "Normal" }
      ]
    },
    footer: {
      text: "üìÖ Generated by HealthSys - ¬© 2025"
    }
  };

  async function showPreview() {
    document.getElementById("preview-container").style.display = "block";
    const container = document.getElementById("preview");
    container.innerHTML = "";

    // Logo
    if (config.logo?.url) {
      const img = document.createElement("img");
      img.src = config.logo.url;
      img.className = "logo";
      container.appendChild(img);
    }

    // Header
    if (config.header?.text) {
      const h = document.createElement("div");
      h.className = "header";
      h.innerText = config.header.text;
      container.appendChild(h);
    }

    // Content as table
    if (config.content?.items) {
      const table = document.createElement("table");
      const tbody = document.createElement("tbody");

      config.content.items.forEach(item => {
        const row = document.createElement("tr");

        const th = document.createElement("th");
        th.innerText = item.field;
        row.appendChild(th);

        const td = document.createElement("td");
        td.innerText = item.value;
        row.appendChild(td);

        tbody.appendChild(row);
      });

      table.appendChild(tbody);
      container.appendChild(table);
    }

    // Footer
    if (config.footer?.text) {
      const f = document.createElement("div");
      f.className = "footer";
      f.innerText = config.footer.text;
      container.appendChild(f);
    }
  }

  function printPreview() {
    window.print();
  }

  async function generatePDF(config) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    let y = 20;

    // Logo
    if (config.logo?.url) {
      try {
        const imgData = await toBase64(config.logo.url);
        doc.addImage(imgData, "PNG", 10, y, config.logo.width || 25, config.logo.height || 25);
      } catch (err) {
        console.warn("Logo failed to load:", err);
      }
    }

    // Header
    if (config.header) {
      doc.setFontSize(config.header.fontSize || 16);
      doc.text(config.header.text, 105, y + 10, {
        align: config.header.align || "center"
      });
      y += 30;
    }

    // Content
    doc.setFontSize(12);
    if (config.content?.items) {
      config.content.items.forEach(item => {
        doc.text(`${item.field}: ${item.value}`, 10, y);
        y += 10;
      });
    }

    // Footer
    if (config.footer) {
      doc.setFontSize(10);
      doc.text(config.footer.text, 105, 285, {
        align: config.footer.align || "center"
      });
    }

    doc.save("medical_report.pdf");
  }

  function toBase64(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "Anonymous";
      img.onload = function () {
        const canvas = document.createElement("canvas");
        canvas.width = this.naturalWidth;
        canvas.height = this.naturalHeight;
        canvas.getContext("2d").drawImage(this, 0, 0);
        resolve(canvas.toDataURL("image/png"));
      };
      img.onerror = reject;
      img.src = url;
    });
  }
</script>

</body>
</html>
